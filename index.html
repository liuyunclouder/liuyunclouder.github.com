<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/libs/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/libs/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Ezio's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ezio's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ezio's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Ezio's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a63d6742fa06ccda252c7c1bdc9649d9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Ezio's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">record</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/04/LLDB命令及扩展/" itemprop="url">
                  LLDB命令及扩展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-02-04T20:00:00+08:00" content="2017-02-04">
              2017-02-04
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/04/LLDB命令及扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/04/LLDB命令及扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="br命令：设置各种类型断点"><a href="#br命令：设置各种类型断点" class="headerlink" title="br命令：设置各种类型断点"></a>br命令：设置各种类型断点</h3><p>列出断点列表</p>
<pre><code>br l
</code></pre><p>删除断点(2是断点id)</p>
<pre><code>br delete 2
</code></pre><p>enable断点</p>
<pre><code>br e 2
</code></pre><p>disable断点</p>
<pre><code>br di 2
</code></pre><p>设置断点(30是行数)</p>
<pre><code>b ViewController.m:30
</code></pre><p>设置symbolic断点</p>
<pre><code>br set -n viewDidLoad
</code></pre><p>设置条件断点</p>
<pre><code>br mod -c &quot;totalValue &gt; 3000&quot; 2
</code></pre><p>删除条件断点</p>
<pre><code>br mod -c &quot;&quot; 2
</code></pre><p>在某一个断点处执行多个命令</p>
<pre><code>br com add 2
&gt; bt
&gt; continue
&gt; DONE
</code></pre><p>继续执行</p>
<pre><code>continue
c
</code></pre><p>单步执行</p>
<pre><code>n
</code></pre><p>单步进入</p>
<pre><code>s
</code></pre><p>退出当前函数</p>
<pre><code>finish
</code></pre><h3 id="expr命令：可以不用修改代码即可以在程序运行时修改程序数据和行为"><a href="#expr命令：可以不用修改代码即可以在程序运行时修改程序数据和行为" class="headerlink" title="expr命令：可以不用修改代码即可以在程序运行时修改程序数据和行为"></a>expr命令：可以不用修改代码即可以在程序运行时修改程序数据和行为</h3><pre><code>expo self.view.hidden = YES
expr -L — 5+5
expr (void)NSLog(@“hello world&quot;)
expr -- (CGRect)[self.view frame]

expr int $debugVar = 5
expr NSString \*$debugString = @&quot;ezio cham&quot;

expr NSData \*$data = [$jsonString dataUsingEncoding: 4] //lldb不认识enum，需要传具体的值
</code></pre><h3 id="backtrace命令"><a href="#backtrace命令" class="headerlink" title="backtrace命令"></a>backtrace命令</h3><pre><code>bt

bt all
</code></pre><h3 id="thread命令：在排查多线程问题时会用到"><a href="#thread命令：在排查多线程问题时会用到" class="headerlink" title="thread命令：在排查多线程问题时会用到"></a>thread命令：在排查多线程问题时会用到</h3><pre><code>thread backtrace

thread backtrace all
</code></pre><p>显示thread列表</p>
<pre><code>thread list
</code></pre><p>选择id为1的thread</p>
<pre><code>thread select 1
</code></pre><p>使用thread命令完成断点功能（100是行号）</p>
<pre><code>thread until 100
</code></pre><p>修改方法返回值（在代码中的return语句所在行执行）</p>
<pre><code>thread return @&quot;new result&quot;
</code></pre><p>example:</p>
<pre><code>thread until 63（63行是当前方法的return语句所在行）
thread return YES
</code></pre><h3 id="frame命令"><a href="#frame命令" class="headerlink" title="frame命令"></a>frame命令</h3><p>查看当前frame的变量列表</p>
<pre><code>frame variable
</code></pre><p>查看当前frame 名为varName的变量的值</p>
<pre><code>frame variable varName

frame info
</code></pre><p>选择id为2的frame</p>
<pre><code>frame select 2
</code></pre><p>选择当前frame的下一个frame</p>
<pre><code>frame select -relative -1
</code></pre><h3 id="watchpoint"><a href="#watchpoint" class="headerlink" title="watchpoint"></a>watchpoint</h3><p>查看当前watchpoint列表</p>
<pre><code>watchpoint list


watchpoint delete 1


watchpoint set variable varName
</code></pre><p>可以watch expression（my_pointer为expression的返回值）</p>
<pre><code>watchpoint set expression — my\_pointer
</code></pre><p>设置watchpoint的条件</p>
<pre><code>watchpoint modify -c “\_x &gt; 0” 1
</code></pre><p>删除条件</p>
<pre><code>watchpoint modify -c “” 1
</code></pre><h3 id="script命令"><a href="#script命令" class="headerlink" title="script命令"></a>script命令</h3><p>查看lldb使用的python版本</p>
<pre><code>script print(sys.version)
</code></pre><p>进入lldb的python环境</p>
<pre><code>script
</code></pre><p>使用python脚本</p>
<pre><code>breakpoint command add -s python 1
</code></pre><p>使用python 函数my_script.breakpoint_func</p>
<pre><code>breakpoint command add -F my\_script.breakpoint\_func 1
</code></pre><h3 id="command命令"><a href="#command命令" class="headerlink" title="command命令"></a>command命令</h3><p>引入python脚本并指定新command命令:cmd_name</p>
<pre><code>command script import “\~/my\_script.py&quot;
command script add -f my\_script.python\_function cmd\_name
</code></pre><p>引入python脚本并设置在断点中使用</p>
<pre><code>command script import “\~/my\_script.py&quot;
breakpoint command add -F my\_script.breakpoint\_func 1
</code></pre><p>引入其他lldb script</p>
<pre><code>command script import “\~/my\_script.txt&quot;
</code></pre><p>删除命令pf</p>
<pre><code>command unalias pf
</code></pre><p>显示命令历史列表（report navigator中有更详细的内容）</p>
<pre><code>command list
</code></pre><h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><p>获取当前所有alias </p>
<pre><code>help -a 
</code></pre><p>获取和关键字相关的alias </p>
<pre><code>apropos break 
</code></pre><p>设置positional alias </p>
<pre><code>command alias sbr breakpoint set -l %1 

command alias pf expr (CGRect)\[self.view frame\] 
</code></pre><p>设置regular alias </p>
<pre><code>command regex sbr ’s/(\[0-9\]+)/breakpoint set -l %1&apos; 

command regex pf 
s/(.+)/expr (CGRect)\[%1 frame\]/ 
s/^$/expr (CGRect)\[self.view frame\]/ 
</code></pre><p>持久化alias<br>创建~/.lldbinit文件 ,添加以下内容： </p>
<pre><code>command regex pf ‘s/(.+)/expr (CGRect)\[%1 frame\]/’ ‘s/^$/expr (CGRect)\[self.view frame\]/’ 
</code></pre><h3 id="custom-summary"><a href="#custom-summary" class="headerlink" title="custom summary"></a>custom summary</h3><pre><code>type summary add CGRect -s &quot;width = ${var.size.width}, height = ${var.size.height}&quot; 
</code></pre><p>为SavingsAccount设置summary </p>
<pre><code>command script import \~/account.py 
type summary add -F account.count\_summary SavingsAccount 
</code></pre><p>删除 </p>
<pre><code>type summary delete CGRect 
</code></pre><p>过滤，只显示firstName属性 </p>
<pre><code>type filter add SavingsAccount —child \_firstName 
</code></pre><p>改变显示格式 </p>
<pre><code>typedef int hex\_month 
type format add —format hex hex\_month 
</code></pre><h3 id="quicklook"><a href="#quicklook" class="headerlink" title="quicklook"></a>quicklook</h3><p>quicklook in lldb<br><a href="https://github.com/ryanolsonk/LLDB-QuickLook" target="_blank" rel="external">https://github.com/ryanolsonk/LLDB-QuickLook</a></p>
<p>quicklook in xcode<br><a href="http://nshipster.com/quick-look-debugging/" target="_blank" rel="external">http://nshipster.com/quick-look-debugging/</a></p>
<h3 id="扩展LLDB命令"><a href="#扩展LLDB命令" class="headerlink" title="扩展LLDB命令"></a>扩展LLDB命令</h3><p>lldb的python接口文档<br><a href="http://lldb.llvm.org/python_reference/index.html" target="_blank" rel="external">http://lldb.llvm.org/python_reference/index.html</a></p>
<h3 id="chisel：Facebook的LLDB扩展"><a href="#chisel：Facebook的LLDB扩展" class="headerlink" title="chisel：Facebook的LLDB扩展"></a>chisel：Facebook的LLDB扩展</h3><pre><code>border self.view 
border --color green self.view 
</code></pre><p>让view透明 </p>
<pre><code>mask self.button 
</code></pre><p>让view从透明状态恢复 </p>
<pre><code>unmask self.button 
</code></pre><p>打印当前界面的layer tree </p>
<pre><code>pca 
</code></pre><p>打印当前界面的view 层级 </p>
<pre><code>pviews 
</code></pre><p>打印view的responder chain </p>
<pre><code>presponder self.view 
</code></pre><p>交互式查看view的层级树 </p>
<pre><code>vs self.view 
</code></pre><p>重绘当前界面 </p>
<pre><code>caflush 
</code></pre><p>快速闪烁view </p>
<pre><code>flicker self.view 
</code></pre><p>显示view </p>
<pre><code>show self.view 
</code></pre><p>隐藏view </p>
<pre><code>hide self.view 
</code></pre><p>打印class的继承树 </p>
<pre><code>pclass self.property 
</code></pre><p>截屏预览 </p>
<pre><code>visualize self.view 
</code></pre>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/28/罗曼波兰斯基/" itemprop="url">
                  罗曼波兰斯基
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-01-28T20:00:00+08:00" content="2017-01-28">
              2017-01-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/28/罗曼波兰斯基/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/28/罗曼波兰斯基/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>过年这几天看了一本波兰斯基的自传以及三部他的传记电影，加上之前看的一些他的电影，可以说对这个世界级导演有一个比较全面的了解，果然是个命运坎坷却又精彩纷呈的人物。</p>
<h3 id="童年的悲惨经历"><a href="#童年的悲惨经历" class="headerlink" title="童年的悲惨经历"></a>童年的悲惨经历</h3><p>波兰斯基的童年正好在二战时纳粹对犹太人迫害最为严重的时候，随着德国对波兰的入侵，波兰斯基一家惨遭不幸：还怀有身孕的母亲以及姐姐被纳粹枪毙，父亲被关入集中营，自己孤身一人辗转于亲友之间。我觉得这段童年时的悲惨经历是他后续放荡不羁的生活态度的一个促成原因。</p>
<h3 id="青年与电影"><a href="#青年与电影" class="headerlink" title="青年与电影"></a>青年与电影</h3><p>战后的波兰斯基痴迷于表演，迫于波兰当时的政治形势，在几度尝试考入表演系失败后，在朋友的推荐下成功考入了导演系，此后波兰斯基就开始了他的电影生涯。导演起初的发展并不怎么顺利，在《水中刀》被波兰电影界批评得体无完肤后，波兰斯基来到法国寻求发展。然而几年后莫名其妙地凭借《水中刀》突然获得好几个奖项，从此这位导演才进入到人们的视野中。</p>
<h3 id="爱情与婚姻"><a href="#爱情与婚姻" class="headerlink" title="爱情与婚姻"></a>爱情与婚姻</h3><p>波兰斯基的矮个子并不妨碍他获得女性的青睐。来到法国，事业起步后，波兰斯基凭借非凡的个人魅力以及艺术才能，身边的女人换了一波又一波，最终在拍摄《冷血惊魂》时成功“勾搭”上了莎伦.塔特，不久后两人就结婚。本是男才女貌（波兰斯基当时也挺帅气），应该幸福美满才对。然而，上天似乎还是不肯放过波兰斯基，怀有8个月身孕的莎伦惨死于一桩邪教谋杀案，这一打击让波兰斯基重回了童年的阴影了。不过，随着时间的流逝以及波兰斯基风流成性的生活习惯，最终在经历了娈童案之后，波兰斯基被迫逃往法国，并在那认识了艾纽曼儿.塞尼耶，这对有着30多年年龄差距的伴侣最终结婚生子，看来浪子波兰斯基最终也要回归家庭了。</p>
<h3 id="欣赏的电影"><a href="#欣赏的电影" class="headerlink" title="欣赏的电影"></a>欣赏的电影</h3><p>波兰斯基的生活曲折惊奇，他的电影也丝毫不逊色。反映二战的《钢琴家》，表现心理恐惧的《罗斯玛丽的婴儿》和《怪房客》，以及反映腐败的《唐人街》，每一部都是经典中的经典。波兰斯基的电影普遍偏于沉重和黑暗，联系到他的童年经历和婚姻，这不难理解，似乎波兰斯基始终相信人性本恶。80多高龄的波兰斯基还在坚持拍电影，2016过去了，真心希望波兰斯基能多活几年，多拍几部好电影。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/21/个人信息系统/" itemprop="url">
                  个人信息系统
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-01-21T20:00:00+08:00" content="2017-01-21">
              2017-01-21
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/21/个人信息系统/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/21/个人信息系统/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在互联网行业工作了几年后，慢慢就形成了自己的一套信息收集和整理流程，今天就介绍了我对这套流程的理解和运用。</p>
<h2 id="什么是个人信息系统"><a href="#什么是个人信息系统" class="headerlink" title="什么是个人信息系统"></a>什么是个人信息系统</h2><p>现在企业都会有一个信息部门，通常这个部门会把整个公司的业务流程整理成一套IT自动化系统，提高公司整体的效率。我理解的个人信息系统也就是这么一套系统，能提高个人的生活、学习、工作效率。</p>
<h2 id="为什么需要个人信息系统"><a href="#为什么需要个人信息系统" class="headerlink" title="为什么需要个人信息系统"></a>为什么需要个人信息系统</h2><p>我们现在处于知识爆炸的时代，这点在互联网行业工作的人体会更为深刻，然而不是所有的信息对你而言都是有效信息，有些反而是有害的，因此过滤出对你，特别是对某个特定阶段的你而言具有价值的信息，就变得非常重要。个人信息系统就可以作为你的渔网，以价值量作为网格，筛选出你想要的信息并允许你做二次编辑，从而丰富和完善你已有的知识体系。</p>
<h2 id="怎么建立自己的信息系统"><a href="#怎么建立自己的信息系统" class="headerlink" title="怎么建立自己的信息系统"></a>怎么建立自己的信息系统</h2><p>就像刘未鹏仔《暗时间》里说的，没有一套完美的时间管理系统能适用于所有人，个人信息系统也是。下面要说的就是我自己的一套信息收集和整理系统。</p>
<p><img src="http://d.pr/i/XSGk+" alt=""></p>
<p>由提醒、来源、存储、笔记、总结组成。</p>
<p>主动的信息收集本身就是一个值得培养的习惯，台湾的文学大家李敖更是从小就有意识地收藏整理资料，而只要是习惯，就必须经历一段时间的培养，好的提醒工具能帮你更快地养成这个习惯。由于我一直用Fantastical 2作为日历工具，它的提醒功能足够用了。</p>
<p>信息来源渠道很多，渠道本身的筛选固然重要，然而，现在很多渠道上的内容重复度都很高，随便选几个不太冷门的APP，基本都能覆盖大部分信息。RSS工具作为信息聚合工具自然少不了，Mac平台上的Feedly、Reeder界面和体验还不错。<br>知乎的内容质量普遍来说高于普通的门户，同时以问题的方式组织更有针对性，同时我也挺喜欢即刻以主题订阅的方式推送你感兴趣的内容。豆瓣上一些猎奇的内容和旅行经历作为消遣也是不错的。高质量的微信公众号上的文章也不能落下，还有平时浏览网页时碰到好的文章。</p>
<p>以上这些信息来源基本都必须快速方便地存入一个地方，保证操作的低成本才更有利于习惯的养成。而Pocket作为老牌的“稍后阅读”APP，在各个信息渠道APP中都有集成，如果没有，也可以通过IFTTT等方式与Pocket关联起来，比如豆瓣（<a href="https://www.douban.com/note/266234206/" target="_blank" rel="external">IFTTT关联豆瓣和Pocket教程</a>）。</p>
<p>信息过滤到Pocket后，就可以抽时间阅读并作好笔记，我一般利用碎片化的时间阅读。我习惯把笔记放入Evernote。</p>
<p>Evernote只是一个笔记收集容器，它没有提供方便的工具来帮你把信息梳理组织成完整的层次化系统。MindNode作为思维导图能补充Evernote这方面的不足。把零散的笔记提炼总结形成系统的知识体系，这一步，是前面所有工作的最终目的和最有价值的部分。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是我的个人信息系统的简单介绍，在移动时代，这套系统基本只需要在手机上装几个APP以及利用碎片化时间就能建立起来，成本不高。在写这篇文章的同时找到知乎上的一篇不错的文章<a href="https://www.zhihu.com/question/23427617" target="_blank" rel="external">https://www.zhihu.com/question/23427617</a>，对建立个人信息系统也有帮助。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/14/iOS framework 发布流程总结/" itemprop="url">
                  iOS framework 发布流程总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-01-14T20:00:00+08:00" content="2017-01-14">
              2017-01-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/14/iOS framework 发布流程总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/14/iOS framework 发布流程总结/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前总结了 <a href="http://liuyunclouder.github.io/2016/12/10/iOS%20framework%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93/" target="_blank" rel="external">iOS framework开发流程</a>，当然，开发完了还需要发布和更新版本，以便开发者能快速方便地使用。</p>
<h2 id="包管理工具"><a href="#包管理工具" class="headerlink" title="包管理工具"></a>包管理工具</h2><p>目前苹果生态下的包管理工具有：Cocoapods、Carthage、Swift Package Manager。Cocoapods是老牌的包管理工具，ruby写的，中心化包管理工具；Carthage是随着Swift的诞生出现的，swift写的，与Cocoapods不同，它是去中心化的；而Swift Package Manager，是苹果官方推出的Swift包管理工具，目前只支持OSX和macOS开发，包括Swift server开发的包管理。</p>
<p>因此，我们需要支持Cocoapods和Carthage。</p>
<h2 id="Cocoapods"><a href="#Cocoapods" class="headerlink" title="Cocoapods"></a>Cocoapods</h2><p>Cocoapods的framework发布流程有两种，一种是Cocoapods官方提供的 <a href="https://guides.cocoapods.org/making/using-pod-lib-create.html" target="_blank" rel="external">pod lib create</a>命令，优点是会自动生成framework发布工程，包含demo工程、测试框架以及符号重命名，缺点是必须把源码文件添加进去以便打framework。当你不想发布源码时，就得使用第二种方式：自己建framework发布工程。<br>1.在github上创建git仓库，目录结构：<br><img src="http://d.pr/i/3Kcg+" alt=""><br>2.生成podspec：进入新建的git仓库，执行以下命令</p>
<pre><code>pod spec create DTTracker
</code></pre><p>3.编辑新生成的podspec文件，添加必要的依赖和编译参数</p>
<pre><code>Pod::Spec.new do |s|


  s.name         = &quot;DTTracker&quot;
  s.version      = &quot;0.0.1&quot;
  s.summary      = &quot;DTTracker SDK&quot;

  s.description  = &quot;you can use DTTracker to track your user behavior in your app&quot;

  s.homepage     = &quot;https://www.dtstack.com/&quot;


  s.license      = &quot;MIT&quot;


  s.author       = { &quot;liuyunclouder&quot; =&gt; &quot;liuyunclouder@gmail.com&quot; }


  s.platform     = :ios, &quot;8.0&quot;



  s.source       = { :git =&gt; &quot;https://github.com/liuyunclouder/DTTracker.git&quot;, :tag =&gt; s.version }


  s.vendored_frameworks = &quot;frameworks/cocoapods/DTTracker.framework&quot;


  s.frameworks = &quot;Foundation&quot;, &quot;UIKit&quot;, &quot;CoreTelephony&quot;

  s.libraries = &quot;sqlite3&quot;, &quot;z&quot;

  s.requires_arc = true

  s.pod_target_xcconfig = { &quot;OTHER_LDFLAGS&quot; =&gt; &quot;-ObjC -all_load&quot; }

end
</code></pre><p>4.提交修改，打上tag，再次带上tag提交（tag要和podspec里的version匹配）<br>5.本地校验podspec：</p>
<pre><code>pod lib lint DTTracker.podspec —verbose
</code></pre><p>6.再次远程校验：</p>
<pre><code>pod spec lint DTTracker.podspec —verbose
</code></pre><p>7.推送到Cocoapods：</p>
<pre><code>pod trunk push DTTracker.podspec
</code></pre><p>8.验证是否推送成功：</p>
<pre><code>rm ~/Library/Caches/CocoaPods/search_index.json
pod search DTTracker
</code></pre><h2 id="Carthage"><a href="#Carthage" class="headerlink" title="Carthage"></a>Carthage</h2><p>Carthage目前只支持动态库，而在<a href="http://liuyunclouder.github.io/2016/12/10/iOS%20framework%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93/" target="_blank" rel="external">iOS framework开发流程</a>中，我们新建的framework是静态库，因此，我们需要新建一个framework工程：<br>1.创建Cocoa touch framework：DTTrackerForCarthage<br>2.添加valid architecture类型<br><img src="http://d.pr/i/ieCH+" alt=""><br>3.添加compile source(.m文件)和header文件<br><img src="http://d.pr/i/G1Aj+" alt=""><br>4.添加link库<br><img src="http://d.pr/i/OHPS+" alt=""><br>5.我们需要让生成的framework名称为DTTracker，而不是DTTrackerForCarthage，因此还需要修改framework名称<br><img src="http://d.pr/i/Y4dW+" alt=""><br>6.修改scheme为shared<br>7.生成framework：进入framework开发工程根目录，执行以下命令</p>
<pre><code>carthage build --no-skip-current
carthage archive DTTracker
</code></pre><p>8.找到生成的DTTrack.framework.zip文件，放入最开始我们创建的framework发布工程，这时我们的目录结构是这样的<br><img src="http://d.pr/i/6YZM+" alt=""><br>9.打tag，提交远程<br>10.创建 github release，提交DTTracker.framework.zip<br><img src="http://d.pr/i/QlL7+" alt=""></p>
<p>当然，每次还要打开命令行去执行carthage命令，显然是浪费时间，为节省时间同时也方便其它同事打framework，我们可以再添加一个aggregate target：<br><img src="http://d.pr/i/Mo3q+" alt=""></p>
<pre><code>set -e

carthage build --no-skip-current
carthage archive ${PROJECT_NAME}

mkdir -p &quot;${PROJECT_DIR}/frameworks/carthage&quot;

mv &quot;${PROJECT_DIR}/${PROJECT_NAME}.framework.zip&quot; &quot;${PROJECT_DIR}/frameworks/carthage&quot;
</code></pre><p>这样，每次我们只需要运行一下这个target对应的scheme就能生成我们需要的DTTracker.framework.zip文件<br><img src="http://d.pr/i/puCw+" alt=""></p>
<p>当然，目前的流程还可以再改进，我们可以再建一个target，修改framework开发工程的版本号后同时为Cocoapods和Carthage打包并copy到framework发布工程，然后修改podspec版本号并打好tag并提交。然而目前就我一个人开发，基本够用，有时间再弄。</p>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a href="https://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="external">https://guides.cocoapods.org/syntax/podspec.html</a></p>
<p><a href="https://github.com/Carthage/Carthage#supporting-carthage-for-your-framework" target="_blank" rel="external">https://github.com/Carthage/Carthage#supporting-carthage-for-your-framework</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/07/《暗时间》阅读笔记/" itemprop="url">
                  《暗时间》阅读笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-01-07T20:00:00+08:00" content="2017-01-07">
              2017-01-07
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/07/《暗时间》阅读笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/07/《暗时间》阅读笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="高效记忆方法"><a href="#高效记忆方法" class="headerlink" title="高效记忆方法"></a>高效记忆方法</h2><p>你拥有的知识并不取决于你记得多少，而在于他们能否在恰当的时候被回忆起来，<br>而能否在恰当的时候回忆起某个知识，关键在于多创造记忆的线索：位置、声音、气味、场景等，相当于多制造索引</p>
<ol>
<li>养成习惯，经常回顾一段时间内学习的内容</li>
<li>创造回忆的机会: 经常和别人讨论、整理笔记、书写体会</li>
<li>设身处地地“虚拟经历”别人经历过的事情</li>
<li>抽象和推广</li>
<li>联系和比较自身的经历</li>
</ol>
<h2 id="时间管理原则"><a href="#时间管理原则" class="headerlink" title="时间管理原则"></a>时间管理原则</h2><ol>
<li>思考问题时要问自己：问题的本质是什么？目前的进展怎么样？我该如何条理清晰地向别人说明这个问题？</li>
<li>注意知识的本质：抓住不变量</li>
<li>重视积累的力量，做好长时间的计划</li>
<li>时不时跳出细节，以宏观的角度看待自己目前的阶段，不要急着去处理细节，判断一件事是否值得去做有时比怎么做一件事更重要</li>
<li>充分利用暗时间：把问题放在大脑里长时间发酵，并保持专注</li>
<li>要事第一：优先处理重要但不紧迫的事</li>
</ol>
<h2 id="阅读学习方法"><a href="#阅读学习方法" class="headerlink" title="阅读学习方法"></a>阅读学习方法</h2><p>关键在于以下三点：</p>
<ol>
<li>能够迅速进入专注状态</li>
<li>能够长期保持专注状态</li>
<li>能够具备超强的抗干扰能力</li>
</ol>
<p>方法：</p>
<ol>
<li>趁着对一件事情有热情的时候，一鼓作气把万事开头难的阶段熬过去</li>
<li>选择好资料</li>
<li>选择性阅读</li>
<li>SQ3R方法（Survey、Question、Read、Recite、Review）</li>
</ol>
<h2 id="知识结构"><a href="#知识结构" class="headerlink" title="知识结构"></a>知识结构</h2><p>专注于不变量，快速浏览易变量</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/31/2016总结/" itemprop="url">
                  2016总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-31T20:00:00+08:00" content="2016-12-31">
              2016-12-31
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/31/2016总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/31/2016总结/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://d.pr/i/fOT1+" alt=""></p>
<p>越来越觉得每年过得越来越快了，要是不记录一下都不知道自己都做了什么。</p>
<p>这一年，找了份后端的工作，熟悉了后端开发，也顺带加强了下计算机底层和网络的基础。有人问为什么放着好好的iOS不做，偏去做一个新的岗位，具体原因有很多，最主要的还是希望自己能在互联网这个行业中走得更远更好，所以希望经受短暂的挫折，可以换来更长远的收获。</p>
<p>今年杭州的房价突然上涨，我也忍耐不住，跟着一起买了房。买房的事情比较折腾，但事情有个着落，心里也踏实。通过这次买房让我有了点小收获：眼光很重要，碰到问题要找数据并动脑去分析，而不是以固有的观念去看待。</p>
<p>去年做了个宝宝拍拍的iOS APP，今年手痒，业余时间写了个Mac APP：<a href="http://liuyunclouder.github.io/2016/10/22/Arsos%20%E2%80%94%20a%20lib%20search%20engine%20for%20coder/" target="_blank" rel="external">Arsos</a>，从web前端、移动端，到后端，都是一人独立完成，算是在独立开发者的路上尝试了一小步。都说从0到1是最困难的，从1到100是简单的，希望明年能在产品设计上多思考一下，能解决用户的痛点。</p>
<p>因为公司需要，年底开始做一个数据采集的iOS SDK：DTTracker，幸好平时也持续关注着，老本行做起来还是驾轻就熟。</p>
<p>今年有朋友给我介绍单子，也有我给朋友介绍单子，还有朋友让我帮忙评估单子，人脉和信誉的确很重要。当然，能力才是最重要的。</p>
<p>今年还做了几个小插件，<a href="https://github.com/liuyunclouder/popclip_extension" target="_blank" rel="external">JSONizer</a>、 <a href="https://github.com/liuyunclouder/alfredworkflow" target="_blank" rel="external">Portkiller</a> 、<a href="https://github.com/liuyunclouder/alfredworkflow" target="_blank" rel="external">Arsos</a>，虽然并没有带来收入，但还是很高兴。</p>
<p>另外一件比较高兴的事情就是考了个证：阿里云企业级互联网架构专业认证（ACP），从此就是有证程序员了。</p>
<p>但今年对我影响最大的就是看了一本书：《软技能》，国外的一位老司机级别的独立开发者写的，关于程序员的各方面的建议，也是因为这本书，让我下定决心在杭州买房。今年看的觉得不错的一本技术类的书就是《深入理解计算机系统》，这本书更多的专注在底层的细节，把《Linux/UNIX系统编程手册》中一些概念做了更详细的说明，另外一本不错的非技术书就是《人类简史》，虽然没有《文明之光》中涉猎的学科和范围那么广，但把从古至今人类社会发展的规律阐述得非常耐人寻味。</p>
<p>最后一件值得记录的事情就是坚持维护了这个博客和微信公众号AppLife，把每周的收获记录下来，和做Arsos以及那些插件一样，希望在能帮助他人的同时增加自己的影响力。</p>
<p>前面路还长，今年能做完这些，对自己还算满意。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/26/请叫我架构师，谢谢/" itemprop="url">
                  请叫我架构师，谢谢
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-26T20:00:00+08:00" content="2016-12-26">
              2016-12-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/26/请叫我架构师，谢谢/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/26/请叫我架构师，谢谢/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>是的，从今往后就可以持证上岗了。</p>
<p>阿里云企业级互联网架构专业认证（ACP）：<br><img src="http://d.pr/i/4kzi+" alt=""></p>
<p>下个月再去考个讲师，隐隐觉得这可以做一个副业…</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/24/C语言中的位操作/" itemprop="url">
                  C语言中的位操作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-24T20:00:00+08:00" content="2016-12-24">
              2016-12-24
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/24/C语言中的位操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/24/C语言中的位操作/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录下C语言中的一些位操作。</p>
<pre><code>#define BIT_POSITION (1 &lt;&lt; 3)    // 00001000
</code></pre><p>为flags设置一个bit：</p>
<pre><code>flags |= BIT_POSITION; 
</code></pre><p>为flags清除一个bit：</p>
<pre><code>flags &amp;= ~BIT_POSITION;
</code></pre><p>查看flags是否有某个bit：</p>
<pre><code>if (flags &amp; BIT_POSITION) {     // do something }
</code></pre><p>查看flags是否设置了MULTI_BITS的所有bit：</p>
<pre><code>if ((flags &amp; MULTI_BITS) == MULTI_BITS) {     // do something }
</code></pre>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/17/iOS绕过HTTPS证书校验/" itemprop="url">
                  iOS绕过HTTPS证书校验
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-17T20:00:00+08:00" content="2016-12-17">
              2016-12-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/17/iOS绕过HTTPS证书校验/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/17/iOS绕过HTTPS证书校验/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　iOS开发中使用的通信协议，除了聊天和物联网相关的APP可能会用到XMPP和MQTT，剩下的应用通常都只会用到HTTP和HTTPS这两种协议，而由于ATS的限制，iOS默认都是实用HTTPS，除非修改项目的info.plist：<br><img src="http://d.pr/i/eMcv+" alt=""></p>
<p>对于HTTPS，熟悉HTTPS协议的人都知道，HTTPS基本上就是在HTTP协议的基础上加了一层SSL/TLS加密协议，这层加密协议在建立通信时除了HTTP本身的3次握手外，还会再经历额外的身份校验、数据加解密过程：<br><img src="http://d.pr/i/AFoF+" alt=""></p>
<p>这些过程中会混合使用非对称加密、对称加密、证书校验和数字签名等手段，其中证书校验的过程：<br><img src="http://d.pr/i/Ik26+" alt=""></p>
<ol>
<li>首先，服务器的运营人员向数字证书认证机构提出公开密钥的申请。数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。</li>
<li>服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信。公钥证书也可叫做数字证书或直接称为证书。</li>
<li>接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：一，认证服务器的公开密钥的是真实有效的数字证书认证机构。二，服务器的公开密钥是值得信赖的。 </li>
<li>此处认证机关的公开密钥必须安全地转交给客户端。使用通信方式时，如何安全转交是一件很困难的事。因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥。  </li>
</ol>
<p>而通常在开发环境中服务端会使用自签名证书，或者即使在生产环境中可能也会使用免费的证书，这些证书的认证机构可信度通常低于那些收费的大型认证机构，这样，在步骤3的时候客户端对证书的认证可能就失败了。最近在开发公司的iOS SDK就碰到这个问题，直接调用HTTPS接口会报错：</p>
<pre><code>HTTP load failed (kCFStreamErrorDomainSSL, -9843)
</code></pre><p>明白了原理后，解决方案就简单了，只需要客户端在校验时对使用的域名设置白名单就行了，以下是使用NSURLSession时需要在delegate上做的修改：</p>
<pre><code>NSURLSessionConfiguration *sessionConfiguration = [NSURLSessionConfiguration defaultSessionConfiguration];
NSURLSession *session = [NSURLSession sessionWithConfiguration:sessionConfiguration delegate:self delegateQueue:Nil];


- (void)URLSession:(NSURLSession *)session didReceiveChallenge:(NSURLAuthenticationChallenge *)challenge completionHandler:(void (^)(NSURLSessionAuthChallengeDisposition, NSURLCredential *))completionHandler{
    if([challenge.protectionSpace.authenticationMethod isEqualToString:NSURLAuthenticationMethodServerTrust]){
        if([challenge.protectionSpace.host isEqualToString:@&quot;recvapi.log.dtstack.com&quot;]){
            NSURLCredential *credential = [NSURLCredential credentialForTrust:challenge.protectionSpace.serverTrust];
            completionHandler(NSURLSessionAuthChallengeUseCredential,credential);
        } else {
            completionHandler(NSURLSessionAuthChallengeCancelAuthenticationChallenge, nil);
        }
    }
}
</code></pre><p>这样就可以解决开发时的证书校验失败的问题。</p>
<p>但这只限于开发阶段，治标不治本，不能在生产环境下使用，要想治本，最好还是更换服务器证书，找个可信度高的大型认证机构重新弄份证书。</p>
<p>服务端更换证书也简单，以Nginx为例，拿到证书后，修改Nginx的配置：</p>
<pre><code>server { 
    listen 443 ssl;
    server_name example.com;

    ssl on;
    ssl_certificate /etc/ssl/private/example_com.crt;
    ssl_certificate_key /etc/ssl/private/example_com.key;
}
</code></pre><p>然后重启服务就行了：</p>
<pre><code>nginx -t &amp;&amp; nginx -s reload
</code></pre>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/10/iOS framework开发流程总结/" itemprop="url">
                  iOS framework开发流程总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-12-10T20:00:00+08:00" content="2016-12-10">
              2016-12-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/10/iOS framework开发流程总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/10/iOS framework开发流程总结/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在做一个iOS的统计SDK，需要从零开始做一个framework，同时为了方便开发，花了点时间折腾，于是顺便总结一下iOS framework的开发流程，不同的Xcode版本流程会有些小区别，以下使用的是7.3.1。</p>
<h2 id="建立framework工程"><a href="#建立framework工程" class="headerlink" title="建立framework工程"></a>建立framework工程</h2><p>建framework工程之前，要先了解framework</p>
<h3 id="framework和-a"><a href="#framework和-a" class="headerlink" title="framework和.a"></a>framework和.a</h3><p>iOS一直只对用户开放静态库，直到iOS8用户才能用动态库，然而这个动态库貌似也只能是进程内，无法跨进程共享。</p>
<p>我们用的更多的还是静态库，iOS静态库有两种类型，framework和.a，看过linux系统方面的人对.a和.so应该都不陌生，事实上苹果下的.a和linux下的.a从格式上来看不是同一个东西，一个是Mach-O，一个是ELF，但其实Mach-O只是苹果在ELF的基础上添加一些额外的段，可以认为基本一样。那么framework呢？可以认为framework只是对.a的一层额外的封装，类似苹果对ipa的封装，把.a文件包装进一个结构化的目录结构，这样就是一个framework。由于framework本身是一个目录，于是可以把属于framework内部的一些资源也放进去，比如头文件、图片、音视频文件等等，从封装的角度来看，framework是比.a更好的选择。</p>
<p>其实，我们不需要了解这么多，也不需要自己建这些目录层次，xcode已经帮我们做了大部分的工作，我们需要的只是改几个配置。</p>
<h3 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h3><p>新建framework工程：<br><img src="http://d.pr/i/Q1tm+" alt=""></p>
<p>填好framework名称，确定，就生成了一个完整的framework工程：<br><img src="http://d.pr/i/G4WS+" alt=""></p>
<p>运行一下，红色的framework就变黑，说明framework已经生成了。但这个framework并不是我们想要的<br><img src="http://d.pr/i/vbRS+" alt=""></p>
<p>这个framework只有arm7和arm64两种架构的指令内容，如果直接发布这个framework，开发者将无法在模拟器上编译，后续我们会说到多架构指令的必要。另外，这是一个动态库，我们需要的是静态库。</p>
<p>在Build Setting里设置以下几个参数<br><img src="http://d.pr/i/CATu+" alt=""><br><img src="http://d.pr/i/13OyS+" alt=""><br><img src="http://d.pr/i/w95z+" alt=""><br><img src="http://d.pr/i/fJqs+" alt=""></p>
<p>Architectures：包含哪些架构指令，这里我们需要添加armv7s架构<br>Build Active Architecture Only：是否只为当前架构编译<br>Dead Code Stripping：是否从framework中删除未使用的代码<br>Link With Standard Libraries：是否链接苹果标准库<br>Mach-O Type：这里有好几种类型，我们需要选中static library<br>Other Linker Flags：链接参数，如果framework中使用了category，最好加上ObjC、all_load，确保运行时系统会加载其中的category<br>Other C Flags：额外的C语言链接参数，如果需要支持bitcode，需要加上-fembed-bitcode<br>Generate Debug Symbols：生成Debug符号，设为Yes，这样作为依赖工程时断点才会生效</p>
<p>重新编译运行：<br><img src="http://d.pr/i/xx82+" alt=""></p>
<p>这离我们想要的framework不远了。</p>
<p>另外，我们新建一个类，毕竟，我们要做一个统计SDK</p>
<pre><code>#import &lt;Foundation/Foundation.h&gt;

@interface DTTrackManager : NSObject

- (void)trackEvent:(NSString *)event;

@end

@implementation DTTrackManager

- (void)trackEvent:(NSString *)event {
    NSLog(@&quot;you are tracking event: %@&quot;, event);
}

@end
</code></pre><p>我们想要把DTTrackManager开放给开发者，让他们能使用这个类，还需要做一点额外设置：<br><img src="http://d.pr/i/S7gk+" alt=""></p>
<p>这样，打包出来的framework就包含了我们想要公开的头文件了<br><img src="http://d.pr/i/FDY4+" alt=""></p>
<h3 id="多架构和打包"><a href="#多架构和打包" class="headerlink" title="多架构和打包"></a>多架构和打包</h3><p>不同的CPU使用不同的指令，我们一般称一套指令为一种架构，比如笔记本电脑的CPU和移动端手机的CPU使用不同的指令，类似的，32位CPU与64位CPU使用不同的指令，因此我们需要一个能包含所有架构指令的framework，这样，开发者才能在不同的CPU环境下都能使用我们的framework。</p>
<p>我们现在的framework包含了3种架构指令，armv7、armv7s、arm64，这些都是iOS系统使用的架构，macbook等macOS系统是无法使用这个framework的，这就导致开发者目前是无法用这个framework在模拟器上调试。</p>
<p>因此，我们需要再添加i386和x86_64这两种桌面端系统使用的架构。我们可以单独编译这两个架构，然后用lipo命令手工合成，但xcode提供了一个更好的方案。<br><img src="http://d.pr/i/1MV1+" alt=""></p>
<p>选中刚创建的DTTrackerCombiner，在Build Phase下添加一个执行脚本：<br><img src="http://d.pr/i/mnl0+" alt=""></p>
<p>脚本内容：</p>
<pre><code>set -e

UNIVERSAL_OUTPUTFOLDER=${BUILD_DIR}/${CONFIGURATION}-universal


mkdir -p &quot;${UNIVERSAL_OUTPUTFOLDER}&quot;


xcodebuild -target &quot;${PROJECT_NAME}&quot; ONLY_ACTIVE_ARCH=NO -configuration ${CONFIGURATION} -sdk iphoneos  BUILD_DIR=&quot;${BUILD_DIR}&quot; BUILD_ROOT=&quot;${BUILD_ROOT}&quot; clean build
xcodebuild -arch x86_64 -arch i386 -target &quot;${PROJECT_NAME}&quot; -configuration ${CONFIGURATION} -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO BUILD_DIR=&quot;${BUILD_DIR}&quot; BUILD_ROOT=&quot;${BUILD_ROOT}&quot; clean build


cp -R &quot;${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework&quot; &quot;${UNIVERSAL_OUTPUTFOLDER}/&quot;


lipo -create -output &quot;${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework/${PROJECT_NAME}&quot; &quot;${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${PROJECT_NAME}.framework/${PROJECT_NAME}&quot; &quot;${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework/${PROJECT_NAME}&quot;


cp -R &quot;${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework&quot; &quot;${PROJECT_DIR}&quot;


open &quot;${PROJECT_DIR}&quot;
</code></pre><p>ps:<br>    -arch x86_64 -arch i386<br>为模拟器编译的两个架构需要显式指定，否则编译报错</p>
<p>选择正确的scheme和目标，开始编译<br><img src="http://d.pr/i/c9O7+" alt=""></p>
<p>如果编译成功，会弹出编译好的framework所在目录，检查下是不是包含了我们想要的全部架构<br><img src="http://d.pr/i/4PQh+" alt=""></p>
<p>One More Thing!<br>把打包scheme的配置改为release<br><img src="http://d.pr/i/J9wX+" alt=""></p>
<p>这样，我们只要把源文件放入这个工程里，设置好需要公开的头文件，就能编译出我们想要的framework了，非常方便。但是，实际开发中，我们需要一边开发framework，一边在使用这个framework的Demo工程里测试这个framework，如果每次都需要编译一遍framework工程，然后在Demo工程里替换framework，这会严重影响开发效率。</p>
<h2 id="Demo工程"><a href="#Demo工程" class="headerlink" title="Demo工程"></a>Demo工程</h2><p>新建一个DTTrackerDemo工程，注意Deployment Target设置不要低于framework的。</p>
<h3 id="接入framework工程"><a href="#接入framework工程" class="headerlink" title="接入framework工程"></a>接入framework工程</h3><p>接入framework工程很简单，在Finder里找到DTTracker.xcodeproj，直接拖入DTTrackerDemo工程中就行了<br><img src="http://d.pr/i/dtg0+" alt=""></p>
<p>这样，就可以直接在Demo工程里运行framework工程的target来编译framework了。注意，framework工程只能存在一份，额外的framework工程必须关掉，否则DTTrackerDemo工程里会找不到DTTracker.xcodeproj下的文件和target。<br><img src="http://d.pr/i/iCHA+" alt=""></p>
<p>我们需要在每次运行Demo工程时先运行framework工程，这样才能获取最新代码，因此在Demo工程的Build Phase中添加对framework的依赖<br><img src="http://d.pr/i/NrWK+" alt=""></p>
<p>这里的Target Dependencies选择DTTracker而不是DTTrackerCombiner只是因为可以缩短打包时间，毕竟DTTrackerCombiner需要把5份架构打进去，而DTTracker只需要打3份。至于为什么DTTracker明明不包含模拟器的架构却可以启动Demo APP，这个需要看下Demo APP的所在目录<br><img src="http://d.pr/i/M7bG+" alt=""><br>Demo APP被放在Debug-iphonesimulator目录下，再看下该目录下的DTTracker.framework<br><img src="http://d.pr/i/1lCdb+" alt=""></p>
<p>没毛病，是模拟器需要的架构。</p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><p>万事具备，来测试一下我们的framework。</p>
<p>在Demo工程的ViewController.m引入framework头文件：</p>
<pre><code>#import &lt;DTTracker/DTTrackManager.h&gt;
</code></pre><p>初始化一个DTTrackManager并调用trackEvent方法</p>
<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.

    DTTrackManager *tracker = [[DTTrackManager alloc] init];
    [tracker trackEvent:@&quot;viewDidLoad&quot;];
}
</code></pre><p>运行<br><img src="http://d.pr/i/tFih+" alt=""></p>
<p>完美！</p>
<p>那打包framework呢？直接在Demo工程里，选中DTTracker.xcodeproj，选中我们之前添加Aggregate target对应的scheme：DTTrackerCombiner，直接打包<br><img src="http://d.pr/i/DL24+" alt=""></p>
<p>至此，我们完成了</p>
<ol>
<li>framework工程的建立和优化，能独立编译可以直接发布的framework</li>
<li>在Demo工程添加对framework工程的依赖，建立了framework开发流程</li>
</ol>
<p>这样，整个我们就可以愉快地开发framework了！</p>
<p>关于framework还有一些没提到的内容，比如bundle资源、添加framework自定义编译宏，后续有时间再写。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpeg"
               alt="Ezio" />
          <p class="site-author-name" itemprop="name">Ezio</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">32</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ezio</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/libs/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/libs/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/libs/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/libs/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/libs/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/libs/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"githubliuyunclouder"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
